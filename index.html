<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="js/uikit.min.js"></script>
    <script src="js/uikit-icons.min.js"></script>
    <link rel="stylesheet" href="css/uikit.min.css" />
    <link rel="icon" type="image/png" href="./img/favicon.png">
    <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
    ></script>
    <style>
      .down-icon{
        float: right;
      }
    </style>
    <title>あんスタイベント計算機β</title>
  </head>
  <body class="">
    <header>
      <!-- Main Navbar -->
      <nav class="uk-container uk-navbar">
          <div class="uk-navbar-left">
              <ul class="uk-navbar-nav">
                  <li class="uk-active">
                      あんスタイベント計算機β
                  </li> 
              </ul>
          </div>
          <div class="uk-navbar-right">
              <ul class="uk-navbar-nav uk-visible@s">
                  <li><a href="#">このサイトについて</a></li>
                  <li><a href="#">ユニットイベント計算</a></li>
                  <li><a href="#">シャッフルイベント計算</a></li>
              </ul>
              <a href="#" class="uk-navbar-toggle uk-hidden@s" uk-navbar-toggle-icon uk-toggle="target: #sidenav"></a>
          </div>
      </nav>
    </header>
    <div id="sidenav" uk-offcanvas="flip: true" class="uk-offcanvas">
      <div class="uk-offcanvas-bar">
          <ul class="uk-nav">
            <li><a href="#">このサイトについて</a></li>
            <li><a href="#">ユニットイベント計算</a></li>
            <li><a href="#">シャッフルイベント計算</a></li>
          </ul>
      </div>
    </div>
    <div class="uk-container">
      <div uk-margin>
        <h3>ユニットイベント計算</h3>
      </div>
      <fieldset class="uk-fieldset">
        <div class="uk-margin">
          <label class="uk-form-label" for="form-stacked-text"
            >目標ポイント:</label
          >
          <div class="uk-form-controls">
            <input
              type="number"
              class="uk-input uk-form-width-small"
              placeholder="350"
              id="target_score"
            />万pt
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="form-stacked-text"
            >アベレージスコア:</label
          >
          <div class="uk-form-controls">
            <input
              type="number"
              class="uk-input uk-form-width-small"
              placeholder="180"
              id="high_score"
            />万
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="form-stacked-text">特攻枚数:</label>
          <div uk-grid>
            <div class="uk-width-1-3">
              星5:
              <select
                class="uk-select uk-form-width-small"
                id="tokkou_5"
              ></select>
            </div>
            <div class="uk-width-1-3">
              星4:
              <select
                class="uk-select uk-form-width-small"
                id="tokkou_4"
              ></select>
            </div>
            <div class="uk-width-1-3">
              星3:
              <select
                class="uk-select uk-form-width-small"
                id="tokkou_3"
              ></select>
            </div>
          </div>
        </div>
        <div class="uk-margin">
          <label class="uk-form-label" for="form-stacked-text">走るBP:</label>
          <div class="uk-form-controls">
            <select
                class="uk-select uk-form-width-small"
                id="bp">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="6">6</option>
                <option value="10">10</option>
            </select>
          </div>
        </div>
        <p uk-margin>
          <input type="button" class="uk-button uk-button-primary" id="submit" value="計算" />
        </p>
        <div uk-margin id="result">
          <div class="uk-container">
              <h3>Result</h3>      
              <dl class="uk-description-list">
                <dt>
                  <label class="uk-form-label" for="form-stacked-text"
                    ><span id="selected_bp"></span>BPで走った場合のライブ回数:</label
                  >
                  <span id="result_live_count" class="count-up count-size uk-text-bold uk-text-large"></span>回
                  <span class="down-icon" uk-icon="chevron-down"></span>
                </dt>
                <dd>
                  <label class="uk-form-label" for="form-stacked-text"
                    >必要なダイヤ数:</label
                  >
                  <span id="result_diamond" class="count-up count-size uk-text-bold uk-text-large"></span>個
                </dd>
                <dd>必要なBP</dd>
                    <dd>スコアボーナス</dd>
                </dl>
          </div>
        </div>
      </fieldset>
    </div>
    <script>
      const tokkou = [
        [
          {"label" :"0","value":0.0},
          {"label" :"0","value":0.2},
          {"label" :"0","value":0.5},
          {"label" :"0","value":0.75},
          {"label" :"0","value":1.0},
          {"label" :"0","value":1.5}
        ],
        [
          {"label" :"0","value":0.0},
          {"label" :"0","value":0.05},
          {"label" :"0","value":0.15},
          {"label" :"0","value":0.25},
          {"label" :"0","value":0.35},
          {"label" :"0","value":0.5}
        ],
        [
          {"label" :"0","value":0.0},
          {"label" :"0","value":0.01},
          {"label" :"0","value":0.02},
          {"label" :"0","value":0.03},
          {"label" :"0","value":0.04},
          {"label" :"0","value":0.05}
        ]
      ]
      for (var i = 0; i < 6; i++) {
        $("#tokkou_5").append('<option value="' + tokkou[0][i]["value"] + '">' + i + "</option>");
        $("#tokkou_4").append('<option value="' + tokkou[1][i]["value"] + '">' + i + "</option>");
        $("#tokkou_3").append('<option value="' + tokkou[2][i]["value"] + '">' + i + "</option>");
      }
      $("#result").hide();
      // 1BPあたりのイベントポイント=2000
      // 1BPあたりスコアボーナス=スコア×0.0002
      // 1BPあたりの取得PASS=10
      // 参加パス1000枚の取得ポイント10万ポイント
      // 参加パス10枚の取得ポイント1000ポイント
      function calc() {
        var result_bp, result_live_count,result_diamond,result_diamond_with_natural_recovery;
        var t = $("#target_score").val();
        var h = $("#high_score").val();
        // 特攻なしの1倍に対して、各種特攻ボーナスの数値を加算
        var tokkou = 1.0 + parseFloat($("#tokkou_5").val()) + parseFloat($("#tokkou_4").val()) + parseFloat($("#tokkou_3").val());
        // 走る際のBP
        var bp = parseInt($("#bp").val());
        // 1BPでライブした場合の獲得ポイント
        var nomal_live_point = h * 10000 * 0.0002 + 2000;
        // 参加パス10でイベントライブした場合の獲得ポイント(1BPで手に入るのが10PASSなので)
        // ライブパスは100枚で1ライブなのでスコアボーナスの方はその1/10で計算する
        var event_live_point = 100 * 10 + (h * 10000 * 0.0002) / 10;
        // サンプル数式 t*10000 = ((h * 10000 * 0.0002) + 2000 + 1000) * x
        result_bp = Math.ceil(
          (t * 10000) / ((nomal_live_point + event_live_point) * tokkou * 1)
        );
        // 1BPの回復に使うダイヤ個数は2個
        result_diamond = result_bp * 2;
        // 30分で1BP回復,24時間で48BP回復,イベントはだいたい7日
        result_diamond_with_natural_recovery = result_bp * 2 - (48 * 7)
        result_live_count = Math.ceil(
          (t * 10000) / ((nomal_live_point + event_live_point) * tokkou * bp)
        );
        $("#result").show();
        $("#selected_bp").text(bp);
        // $("#result").val(result_bp);
        $("#result_live_count").text(result_live_count);
        $("#result_diamond").text(result_diamond);
        // カウントアップアニメーション用スクリプト
        $(".count-up").each(function(){
        $(this).prop('Counter',0).animate({//0からカウントアップ
              Counter: $(this).text()
          }, {
          // スピードやアニメーションの設定
              duration: 2000,//数字が大きいほど変化のスピードが遅くなる。2000=2秒
              easing: 'swing',//動きの種類。他にもlinearなど設定可能
              step: function (now) {
                  $(this).text(Math.ceil(now));
              }
          });
        });
      }
      const button = document.getElementById("submit");
      button.setAttribute("onclick", "calc()");
    </script>
  </body>
</html>
